# final
# Water Portfolio

## Project Description

**Water Portfolio** is a web application that demonstrates the distribution of water on Earth. The app includes user authentication and authorization, portfolio management (creating, editing, and deleting records), API integration for data visualization, and email notifications using Nodemailer.

## Key Features

### 1. **Authentication and Authorization**

- **Registration**: Users can register by providing the following information:
  - `Username`
  - `Password`
  - `First Name`
  - `Last Name`
  - `Age`
  - `Gender`
  - **Optional**: Two-factor authentication (2FA) setup using an authenticator app.

- **Password Security**: User passwords are securely hashed using `bcrypt`.

- **Login**: After successful registration, users can log in with their username and password. If 2FA is enabled, users will be prompted to enter a time-based one-time password (TOTP) generated by an authenticator app.

- **2FA**: Both the password and the correct 2FA code are required for successful authentication.

- **Role-based Access (RBAC)**: There are three user roles in the system:
  - **Admin**: Full access to create, update, and delete portfolio items.
  - **Editor**: Can only create portfolio items, but cannot edit or delete them.
  - **User**: Regular users with no content management privileges.

- **Security**: Authentication uses both session cookies and token-based mechanisms for enhanced security. After three failed login attempts, users are notified of potential unauthorized activity.

### 2. **Portfolio Management (CRUD Operations)**

- **Portfolio Page**: Admin users can manage portfolio items, which include:
  - **Three images**, displayed in a carousel.
  - **Title**, **Description**, and timestamps showing creation, update, and deletion dates.

- **Admin Functionality**: Admins can create, update, and delete portfolio items. All changes are synchronized with the database.

- **Editor Functionality**: Editors can create new portfolio items but cannot edit or delete them.

### 3. **API Integration and Data Visualization**

- **Integration with Chart.js**: The application integrates with an API to visualize data in charts. For example, the app displays a pie chart showing the distribution of water on Earth.
  
  - **Data**: The chart shows the percentage distribution of water on Earth:
    - Rivers and lakes
    - Icebergs
    - Oceans

- **Data Fetching**: The chart data is fetched from the server, which returns the configuration and data for rendering the chart.

### 4. **Messaging and Notifications with Nodemailer**

- **Welcome Email**: Users receive a personalized welcome email after successful registration.

- **Portfolio Notifications**: Users are notified by email when:
  - A new portfolio item is created.
  - An existing item is updated.

- **Security Alerts**: After three failed login attempts, users receive an alert about potential unauthorized activity.

## Project Setup

### Requirements

- **Node.js**: Version 14 or higher.
- **MongoDB**: A local or cloud MongoDB database (e.g., MongoDB Atlas).

### Steps to Run the Project Locally

1. **Clone the repository**:

bash
cd water-portfolio
Install dependencies:

2. **Make sure to install all necessary dependencies**:

bash
npm install
Set up environment variables:

3. **Create a .env file in the root directory of the project and add the following variables**:

makefile
MONGODB_URI=mongodb://localhost:27017/yourdbname
SESSION_SECRET=your-session-secret
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-email-password

4. **To start the app, run the following command**:

bash
npm start
The application will run on http://localhost:3000.


5. **Open your web browser and go to http://localhost:3000 to view the app.**

## Database Setup
The application uses MongoDB to store user and portfolio data. Make sure MongoDB is running locally or connected to a cloud database like MongoDB Atlas.
2FA Setup
Users can enable two-factor authentication (2FA) during registration. They will need to use an authenticator app (such as Google Authenticator or Authy) to generate one-time passwords (TOTP).
During login, users with 2FA enabled will be prompted to enter the one-time password from their authenticator app.
Project Structure:
node_login/
├── models/
│   ├── Portfolio.js
│   └── User.js
├── node_modules/
├── public/
│   ├── styles.css
│   ├── wat.jpg
│   ├── wat1.png
│   └── wat2.jpg
├── views/
│   ├── 2fa-setup.ejs
│   ├── 2fa.ejs
│   ├── dashboard.ejs
│   ├── index.ejs
│   ├── login.ejs
│   └── register.ejs
├── .env
├── mongoConfig.js
├── package-lock.json
├── package.json
└── passportConfig.js

API
1. /chart (GET)
Description: Fetches data for rendering a pie chart about the distribution of water on Earth.
Response: A JSON object containing the configuration for the chart.

json
{
  "type": "doughnut",
  "data": {
    "datasets": [
      {
        "data": [1, 2, 97],
        "backgroundColor": ["rgb(255, 205, 86)", "rgb(75, 192, 192)", "rgb(54, 162, 235)"],
        "label": "Dataset 1"
      }
    ],
    "labels": ["Rivers and Lakes", "Icebergs", "Oceans"]
  },
  "options": {
    "title": {
      "display": true,
      "text": "Earth Water Distribution"
    }
  }
}
